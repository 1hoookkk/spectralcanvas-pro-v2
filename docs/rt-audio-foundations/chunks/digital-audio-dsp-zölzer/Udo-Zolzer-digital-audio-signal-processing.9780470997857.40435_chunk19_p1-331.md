# Digital Audio DSP (Zölzer) — Chunk 19/30

> Source: `Udo-Zolzer-digital-audio-signal-processing.9780470997857.40435.pdf` · Pages ~1-331 · Extractor: pdfminer.six
> Target ≈ 2800 words, Overlap = 200 words · Actual = 3770

> Note: DSP textbook content for SpectralCanvasPro RT-audio knowledge base

---
Chapter 6
Room Simulation
Room simulation artiﬁcially reproduces the acoustics of a room. The foundations of room
acoustics are found in [Cre78, Kut91]. Room simulation is mainly used for post-processing
signals in which a microphone is located in the vicinity of an instrument or a voice. The
direct signal, without additional room impression, is mapped to a certain acoustical room,
for example a concert hall or a church. In terms of signal processing, the post-processing
of an audio signal with room simulation corresponds to the convolution of the audio signal
with a room impulse response.
6.1 Basics
6.1.1 Room Acoustics
The room impulse response between two points in a room can be classiﬁed as shown in
Fig. 6.1. The impulse response consists of the direct signal, early reﬂections (from walls)
and subsequent reverberation. The number of early reﬂections continuously increases with
time and leads to a random signal with exponential decay called subsequent reverberation.
The reverberation time (decrease in sound pressure level by 60 dB) can be calculated, using
the geometry of the room and the partial areas that absorb sound in the room, from
T60 = 0.163
V
αS
= 0.163
[m/s]
V(cid:11)
n αnSn
(6.1)
where T60 is the reverberation time (in s), V the volume of the room (m3), Sn the partial
areas (m2) and αn the absorption coefﬁcient of partial area Sn.
The geometry of the room also determines the eigenfrequencies of a three-dimensional
rectangular room:
"
(cid:24)
fe = c
2
(cid:24)
(cid:25)
2
+
(cid:25)
2
(cid:24)
+
(cid:25)
2
,
nz
lz
ny
ly
nx
lx
(6.2)
where nx, ny , nz are integer number of half waves (0, 1, 2, . . .), lx , ly, lz are dimensions
of a rectangular room, and c is the velocity of sound.
Digital Audio Signal Processing Second Edition Udo Zölzer
© 2008 John Wiley & Sons, Ltd
192
Room Simulation
|h(n)|
Direct Signal
Early Reflections
Subsequent Reverberation
n
Figure 6.1 Room impulse response h(n) and simpliﬁed decomposition into direct signal, early
reﬂections and subsequent reverberation (with |h(n)|).
For larger rooms, the eigenfrequencies start from very low frequencies. In contrast, the
lowest eigenfrequencies of smaller rooms are shifted toward higher frequencies. The mean
frequency between two extrema of the frequency response of a large room is approximately
inversely proportional to the reverberation time [Schr87]:
(cid:8)f ∼ 1/T60.
(6.3)
The distance between two eigenfrequencies decreases with increasing number of half
waves. Above a critical frequency
(cid:31)
fc > 4000
T60/V ,
(6.4)
the density of eigenfrequencies becomes so large that they overlap each other [Schr87].
6.1.2 Model-based Room Impulse Responses
The methods for analytically determining a room impulse response are based on the ray
tracing model [Schr70] or image model [All79]. In the case of the ray tracing model, a
point source with radial emission is assumed. The path length of rays and the absorption
coefﬁcients of walls, roofs and ﬂoors are used to determine the room impulse response (see
Fig. 6.2). For the image model, image rooms with secondary image sources are formed
which in turn have further image rooms and image sources. The summation of all image
sources with corresponding delays and attenuations provides the estimated room impulse
response. Both methods are applied in room acoustics to get insight into the acoustical
properties when planning concert halls, theaters, etc.
6.1 Basics
193
(cid:9):(cid:14)(cid:19)(cid:9)"(cid:14)+(cid:8)(cid:9)(cid:20)(cid:16)(cid:10)(cid:3)
.:(cid:14)L(cid:16)(cid:8)(cid:7)(cid:13)(cid:9)(cid:4)(cid:14)(cid:27)(cid:12)(cid:9)(cid:3)(cid:2)(cid:14)(cid:6)(cid:11)(cid:13)(cid:8)(cid:20)(cid:2)(cid:18)
Figure 6.2 Model-based methods for calculating room impulse responses.
6.1.3 Measurement of Room Impulse Responses
The direct measurement of a room impulse response is carried out by impulse excitation.
Better measurement results are obtained by correlation measurement of room impulse
responses by using pseudo-random sequences as the excitation signal. Pseudo-random
sequences can be generated by feedback shift registers [Mac76]. The pseudo-random se-
quence is periodic with period L = 2N − 1, where N is the number of states of the shift
register. The autocorrelation function (ACF) of such a random sequence is given by
rXX(n) =



a2,
−a2
L
n = 0, L, 2L, . . . ,
,
elsewhere,
(6.5)
where a is the maximum value of the pseudo-random sequence. The ACF also has a
period L. After going through a DA converter, the pseudo-random signal is fed through
a loudspeaker into a room (see Fig. 6.3).
Pseudo
Noise
x(t)
Room
y(t)
Analog Inputs
L/R
Dig. Output
AD-
converter
PC
CC -> h(n)
Figure 6.3 Measurement of room impulse response with pseudo-random signal x(t).
At the same time, the pseudo-random signal and the room signal captured by a mi-
crophone are recorded on a personal computer. The impulse response is obtained with the
cyclic cross-correlation
rXY (n) = rXX(n) ∗ h(n) ≈ ˜h(n).
(6.6)
For the measurement of room impulse responses it has to be borne in mind that the periodic
length of the pseudo-random sequence must be longer than the length of the room impulse
response. Otherwise, aliasing in the periodic cross-correlation rXY (n) (see Fig. 6.4) occurs.
194
Room Simulation
r
(n)
XX
r
(n)=h(n)
XY
0
0
L
L
2L
2L
n
n
Figure 6.4 Periodic autocorrelation of pseudo-random sequence and periodic cross-correlation.
To improve the signal-to-noise ratio of the measurement, the average of several periods of
the cross-correlation is calculated.
Sine sweep measurements [Far00, Mül01, Sta02] are based on a chirp signal xS(t) of
length TC and an inverse signal xSinv(t), where both satisfy the condition
xS(t) ∗ xSinv(t) = δ(t − TC ).
(6.7)
The chirp signal can be applied to the room by a loudspeaker and then a signal inside the
room y(t) = xS(t) ∗ h(n) is recorded. By performing the convolution of the received signal
y(t) with the inverse signal xSinv(t) one obtains the impulse response from
y(t) ∗ xSinv(t) = xS(t) ∗ h(n) ∗ xSinv(t) = h(t − TC).
(6.8)
6.1.4 Simulation of Room Impulse Responses
The methods just described provide means for calculating the impulse response from the
geometry of a room and for measuring the impulse response of a real room. The reproduc-
tion of such an impulse response is basically possible with the help of the fast convolution
method as described in Chapter 5. The ear signals at a listening position inside the room
are computed by
yL(n) =
yR(n) =
N−1(cid:6)
k=0
N−1(cid:6)
k=0
x(k) · hL(n − k),
x(k) · hR(n − k),
(6.9)
(6.10)
where hL(n) and hR(n) are the measured impulse responses between the source inside the
room, which generates the signal x(n), and a dummy head with two ear microphones.
Special implementations of fast convolution with low latency are described in [Soo90,
6.2 Early Reﬂections
195
Gar95, Rei95, Ege96, Mül99, Joh00, Mül01, Garc02] and a hybrid approach based on
convolution and recursive ﬁlters can be found in [Bro01]. Investigations regarding fast
convolution with sparse psychoacoustic-based room impulse responses are discussed in
[Iid95, Lee03a, Lee03b].
In the following sections we will consider special approaches for early reﬂections and
subsequent reverberation, which allow a parametric adjustment of all relevant parameters
of a room impulse response. With this approach an accurate room impulse response is
not possible, but with a moderate computational complexity a satisfying solution from an
acoustic point of view can be achieved. In Section 6.4 an efﬁcient implementation of the
convolutions (6.9) and (6.10) with a multirate signal processing approach [Zöl90, Sch92,
Sch93, Sch94] is discussed.
6.2 Early Reﬂections
Early reﬂections decisively affect room perception. Spatial impression is produced by
early reﬂections which reach the listener laterally. The signiﬁcance of lateral reﬂections
in creating spatial impression was investigated by Barron [Bar71, Bar81]. Fundamental
investigations of concert halls and their different acoustics are described by Ando [And90].
6.2.1 Ando’s Investigations
The results of the investigations by Ando are summarized in the following:
• Preferred delay time of a single reﬂection: with the ACF of the signal, the delay is
determined from |rxx((cid:8)t1)| = 0.1 · rxx(0).
• Preferred direction of a single reﬂection: ±(55◦ ± 20◦).
• Preferred amplitude of a single reﬂection: A1 = ±5 dB.
• Preferred spectrum of a single reﬂection: no spectral shaping.
• Preferred delay time of a second reﬂection: (cid:8)t2 = 1.8 · (cid:8)t1.
• Preferred reverberation time: T60 = 23 · (cid:8)t1.
These results show that in terms of perception, a preferred pattern of reﬂections as well
as the reverberation time depend decisively on the audio signal. Hence, for different audio
signals like classical music, pop music, speech or musical instruments entirely different
requirements for early reﬂections and reverberation time have to be considered.
6.2.2 Gerzon Algorithm
The commonly used method of simulating early reﬂections is shown in Figs 6.5 and 6.6.
The signal is weighted and fed into a system generating early reﬂections, followed by an
addition to the input signal. The ﬁrst M reﬂections are implemented by reading samples
from a delay line and weighting these samples with a corresponding factor gi (see Fig. 6.6).
The design of a system for simulating early reﬂections will now be described as proposed
by Gerzon [Ger92].
196
Room Simulation
’7(cid:10):
"7(cid:10):
(cid:30)(cid:9)(cid:8)(cid:4)"(cid:14)(cid:19)(cid:2)%(cid:4)(cid:2)(cid:20)(cid:7)(cid:16)(cid:11)(cid:10)(cid:18)
(cid:6)(cid:16)(cid:12)(cid:13)(cid:4)(cid:9)(cid:7)(cid:11)(cid:8)
Figure 6.5 Simulation of early reﬂections.
’7(cid:10):
(cid:30)(cid:9)(cid:8)(cid:4)"(cid:14)(cid:19)(cid:2)%(cid:4)(cid:2)(cid:20)(cid:7)(cid:16)(cid:11)(cid:10)(cid:18)
(cid:6)(cid:16)(cid:12)(cid:13)(cid:4)(cid:9)(cid:7)(cid:11)(cid:8)
(cid:3)
(cid:22)
(cid:3)
(cid:23)
(cid:3)
/
"7(cid:10):
Figure 6.6 Early reﬂections.
Craven Hypothesis. The Craven hypothesis [Ger92] states that the human perception of
the distance to a sound source is evaluated with the help of the amplitude and delay time
ratios of the direct signal and early reﬂections as given by
g = d
d (cid:14) ,
TD = d (cid:14) − d
⇒ d = cT D
g−1 − 1
c
,
(6.11)
(6.12)
(6.13)
where d is the distance of the source, d (cid:14) the distance of the image source of the ﬁrst
reﬂection, g the relative amplitude of the direct signal to ﬁrst reﬂection, c the velocity
of sound, and TD the relative delay time of the ﬁrst reﬂection to the direct signal.
Without a reﬂection, human beings are not able to determine the distance d to a sound
source. The extended Craven hypothesis includes the absorption coefﬁcient r for
determining
d (cid:14) exp(−rTD),
g = d
TD = d (cid:14) − d
c
(6.14)
(6.15)
cT D
g−1 exp(−rT D) − 1
→ d =
→ g = exp(−rT D)
1 + cT D/d
For a given reverberation time T60, the absorption coefﬁcient can be calculated by using
exp(−rT60) = 1/1000, that is,
r = (ln 1000)/T60.
With the relationships (6.15) and (6.17), the parameters for an early reﬂections simulator
as shown in Fig. 6.5 can be determined.
(6.17)
(6.18)
(6.16)
.
6.2 Early Reﬂections
197
Gerzon’s Distance Algorithm. For a system simulating early reﬂections produced by more
than one sound source, Gerzon’s distance algorithm can be used [Ger92], where several
sound sources are placed at different distances as well as in the stereo position into a
stereophonic sound ﬁeld. An application of this technique is mainly used in multichannel
mixing consoles.
By shifting a sound source by −δ (decrease of relative delay time) it follows that from
the relative delay time of the ﬁrst reﬂection TD − δ/c = [d (cid:14) − (d + δ)]/c, and the relative
amplitude according to (6.17),
gδ =
1
1 + c(TD−δ/c)
d+δ
exp(−r(TD − δ/c)) =
(cid:4)
(cid:5)
d + δ
d
exp(rδ/c)
exp(−rT D)
1 + cT D/d
.
(6.19)
This results in a delay and a gain factor for the direct signal (see Fig. 6.7) as given by
d2 = d + δ,
tD = δ/c,
gD = d
d + δ
exp(−rδ/c).
(6.20)
(6.21)
(6.22)
x(n)
DEL
y(n)
Early Reflections
Simulator
h(n)
Direct Signal
n
Early Reflections
Figure 6.7 Delay and weighting of the direct signal.
By shifting a sound source by +δ (increase in relative delay time) the relative delay
time of the ﬁrst reﬂection is TD − δ/c = [d (cid:14) − (d − δ)]/c. As a consequence, the delay
and the gain factor for the effect signal (see Fig. 6.8) are given by
d2 = d − δ,
tE = δ/c,
gE = d
d + δ
exp(−rδ/c).
(6.23)
(6.24)
(6.25)
Using two delay systems in the direct signal as well as in the reﬂection path, two cou-
pled weighting factors and delay lengths (see Fig. 6.9) can be obtained. For multichannel
198
Room Simulation
x(n)
y(n)
Early Reflections
Simulator
DEL
h(n)
Direct Signal
n
Early Reflections
Figure 6.8 Delay and weighting of effect signal.
applications like digital mixing consoles, the scheme in Fig. 6.10 is suggested by Gerzon
[Ger92]. Only one system for implementing early reﬂections is necessary.
’7(cid:10):
"7(cid:10):
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:30)(cid:9)(cid:8)(cid:4)"(cid:14)(cid:19)(cid:2)%(cid:4)(cid:2)(cid:20)(cid:7)(cid:16)(cid:11)(cid:10)(cid:18)
(cid:6)(cid:16)(cid:12)(cid:13)(cid:4)(cid:9)(cid:7)(cid:11)(cid:8)
Figure 6.9 Coupled factors and delays.
Stereo Implementation. In many applications, stereo signals have to be processed (see
Fig. 6.11). For this purpose, reﬂections from both sides with positive and negative angles
are implemented to avoid stereo displacements. The weighting is done with
gi = exp(−rT i)
1 + cT i/d
,
(cid:1)
Gi = gi
cos (cid:13)i −sin (cid:13)i
cos (cid:13)i
sin (cid:13)i
(cid:2)
.
(6.26)
For each reﬂection, a weighting factor and an angle have to be considered.
Generation of Early Reﬂection with Increasing Time Density. In [Schr61] it is stated
that the time density of reﬂections increases with the square of time:
Number of reﬂections per second = (4πc3/V ) · t 2.
(6.27)
After time tC the reﬂections have a statistical decay behavior. For a pulse width of (cid:8)t,
individual reﬂections overlap after
(cid:31)
tC = 5 · 10
−5
V /(cid:8)t.
(6.28)
6.2 Early Reﬂections
199
’(cid:14)(cid:14)7(cid:10):
(cid:22)
’(cid:14)(cid:14)7(cid:10):
(cid:23)
’(cid:14)(cid:14)7(cid:10):
(cid:24)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:26)(cid:30)(cid:15)(cid:14)
(cid:30)(cid:9)(cid:8)(cid:4)"(cid:14)(cid:19)(cid:2)%(cid:4)(cid:2)(cid:20)(cid:7)(cid:16)(cid:11)(cid:10)(cid:18)
(cid:6)(cid:16)(cid:12)(cid:13)(cid:4)(cid:9)(cid:7)(cid:11)(cid:8)
"7(cid:10):
Figure 6.10 Multichannel application.
’(cid:14)(cid:14)7(cid:10):(cid:15)
’(cid:14)(cid:14)7(cid:10):
(cid:19)
(cid:30)(cid:9)(cid:8)(cid:4)"(cid:14)(cid:19)(cid:2)%(cid:4)(cid:2)(cid:20)(cid:7)(cid:16)(cid:11)(cid:10)(cid:18)
(cid:6)(cid:16)(cid:12)(cid:13)(cid:4)(cid:9)(cid:7)(cid:11)(cid:8)
#(cid:22) #(cid:23)
#/
"(cid:14)(cid:14)7(cid:10):(cid:15)
"(cid:14)(cid:14)7(cid:10):(cid:19)
Figure 6.11 Stereo reﬂections.
To avoid overlap of reﬂections, Gerzon [Ger92] suggests increasing the density of reﬂec-
tions with t p (for example, p = 1, 0.5 leads to t or t 0.5). In the interval (0, 1], with initial
value x0 and a number k between 0.5 and 1 the following procedure is performed:
yi = x0 + ik (mod 1),
i = 0, 1, . . . , M − 1.
(6.29)
The numbers yi in the interval (0, 1] are now transformed to time delays Ti in the interval
[Tmin, Tmin + Tmax] by
b = T 1+p
min ,
a = (Tmax + Tmin)1+p − b,
+ b)1/(1+p).
Ti = (ayi
(6.30)
(6.31)
(6.32)
The increase in the density of reﬂections is shown by the example in Fig. 6.12.
200
Room Simulation
→
s
m
n
i
t
100
90
80
70
60
50
40
30
20
10
0
0
1
2
3
6
5
4
Reflections →
7
8
9
10
Figure 6.12 Increase in density for nine reﬂections.
6.3 Subsequent Reverberation
This section deals with techniques for reproducing subsequent reverberation. The ﬁrst
approaches by Schroeder [Schr61, Schr62] and their extension by Moorer [Moo78] will
be described. Further developments by Stautner and Puckette [Sta82], Smith [Smi85],
Dattarro [Dat97], and Gardner [Gar98] led to general feedback networks [Ger71, Ger76,
Jot91, Jot92, Roc95, Roc96, Roc97, Roc02] which have a random impulse response with
exponential decay. An extensive discussion on analysis and synthesis parameters of sub-
sequent reverberation can be found in [Ble01]. Apart from the echo density, an important
parameter of subsequent reverberation [Cre03] is the quadratic increase in
Frequency density = 4πV
c3
· f 2
(6.33)
with frequency. The following systems exhibit a quadratic increase in echo density and
frequency density.
6.3.1 Schroeder Algorithm
The ﬁrst software implementations of room simulation algorithms were carried out in 1961
by Schroeder. The basis for simulating an impulse response with exponential decay is a
recursive comb ﬁlter as shown in Fig. 6.13.
The transfer function is given by
H (z) = z−M
1 − gz−M ,
M−1(cid:6)
Ak
z − zk
k=0
=
,
(6.34)
(6.35)
6.3 Subsequent Reverberation
201
’7(cid:10):
"7(cid:10):
(cid:5)/
(cid:3)
Figure 6.13 Recursive comb ﬁlter (g = feedback factor, M = delay length).
with
Ak = zk
Mg
residues,
zk = r ej 2πk/M poles,
r = g1/M
pole radius.
(6.36)
(6.37)
(6.38)
With the correspondence of the Z-transform a/(z − a) ◦—• (cid:14)(n − 1)an the impulse re-
sponse is given by
H (z) ◦—• h(n) = (cid:14)(n − 1)
Mg
h(n) = (cid:14)(n − 1)
Mg
M−1(cid:6)
k=0
zn
k
r n
M−1(cid:6)
k=0
ej (cid:4)kn.
(6.39)
The complex poles are combined as pairs so that the impulse response can be written as
h(n) = (cid:14)(n − 1)
Mg
r n
= (cid:14)(n − 1)
Mg
r n
M/2−1(cid:6)
cos (cid:4)kn,
M even,
(6.40)
k=1
(cid:4)
1 +
M+1/2−1(cid:6)
k=1
(cid:5)
cos (cid:4)kn
, M uneven.
(6.41)
The impulse response is expressed as a summation of cosine oscillations with frequencies
(cid:4)k. These frequencies correspond to the eigenfrequencies of a room. They decay with an
exponential envelope r n, where r is the damping constant (see Fig. 6.15a). The overall
impulse response is weighted by 1/Mg. The frequency response of the comb ﬁlter is shown
in Fig. 6.15c and is given by
"
|H (ej (cid:4))| =
1
1 − 2g cos((cid:4)M) + g2 .
It shows maxima at (cid:4) = 2πk/M(k = 0, 1, . . . , M − 1) of magnitude
|H (ej (cid:4))|max = 1
1 − g
,
and minima at (cid:4) = (2k + 1)π/M(k = 0, 1, . . . , M − 1) of magnitude
|H (ej (cid:4))|min = 1
1 + g
.
(6.42)
(6.43)
(6.44)

202
Room Simulation
Another basis of the Schroeder algorithm is the all-pass ﬁlter shown in Fig. 6.14 with
transfer function
H (z) = z−M − g
1 − gz−M
= z−M
1 − gz−M
−
g
1 − gz−M .
(6.45)
(6.46)
From (6.46) it can be seen that the impulse response can also be expressed as a summation
of cosine oscillations.
’7(cid:10):
(cid:3)
(cid:5)/
(cid:5)(cid:3)
"7(cid:10):
Figure 6.14 All-pass ﬁlter (M = delay length).
The impulse responses and frequency responses of a comb ﬁlter and an all-pass ﬁlter are
presented in Fig. 6.15. Both impulse responses show an exponential decay. A sample in the
impulse response occurs every M sampling periods. The density of samples in the impulse
responses does not increase with time. For the recursive comb ﬁlter, spectral shaping due
to the maxima at the corresponding poles of the transfer function is observed.
Frequency Density
The frequency density describes the number of eigenfrequencies per hertz and is deﬁned
for a comb ﬁlter [Jot91] as
(6.47)
A single comb ﬁlter gives M resonances in the interval [0, 2π], which are separated by a
frequency distance of (cid:8)f = fS/M. In order to increase the frequency density, a parallel
circuit (see Fig. 6.16) of P comb ﬁlters is used which leads to
[1/Hz].
Df = M · TS
H (z) =
P(cid:6)
p=1
z−Mp
1 − gpz−Mp
(cid:4)
=
z−M1
1 − g1z−M1
+
z−M2
1 − g2z−M2
(cid:5)
.
+ · · ·
The choice of the delay systems [Schr62] is suggested as
M1 : MP = 1 : 1.5
and leads to a frequency density
Df =
P(cid:6)
p=1
Mp · TS = P · M · TS.
(6.48)
(6.49)
(6.50)
