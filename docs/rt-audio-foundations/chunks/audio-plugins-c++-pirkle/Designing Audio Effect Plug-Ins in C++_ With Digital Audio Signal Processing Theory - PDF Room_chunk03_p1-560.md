# Audio Plugins C++ (Pirkle) — Chunk 3/73

> Source: `Designing Audio Effect Plug-Ins in C++_ With Digital Audio Signal Processing Theory - PDF Room.pdf` · Pages ~1-560 · Extractor: pdfminer.six
> Target ≈ 2800 words, Overlap = 200 words · Actual = 4296

> Note: DSP textbook content for SpectralCanvasPro RT-audio knowledge base

---
Contents
   Introduction .....................................................................................................xvii
   Chapter 1: Digital Audio Signal Processing Principles ..............................................1
  1.1  Acquisition of Samples .......................................................................................... 1
  1.2  Reconstruction of the Signal .................................................................................. 3
  1.3  Signal Processing Systems .................................................................................... 4
  1.4  Synchronization and Interrupts .............................................................................. 5
  1.5  Signal Processing Flow .......................................................................................... 6
  1.6  Numerical Representation of Audio Data .............................................................. 7
  1.7  Using Floating-Point Data ..................................................................................... 9
  1.8  Basic DSP Test Signals ........................................................................................ 10
1.8.1  DC and Step ...................................................................................................10
1.8.2  Nyquist ...........................................................................................................11
1.8.3  ½ Nyquist .......................................................................................................11
1.8.4  ¼ Nyquist .......................................................................................................12
1.8.5  Impulse ...........................................................................................................12
  1.9  Signal Processing Algorithms .............................................................................. 13
  1.10  Bookkeeping ........................................................................................................ 13
  1.11  The One-Sample Delay ........................................................................................ 15
  1.12  Multiplication ...................................................................................................... 16
  1.13  Addition and Subtraction ..................................................................................... 17
  1.14  Algorithm Examples and the Difference Equation .............................................. 18
  1.15  Gain, Attenuation, and Phase Inversion ............................................................... 18
  1.16  Practical Mixing Algorithm ................................................................................. 19
Bibliography ................................................................................................................. 20
   Chapter 2: Anatomy of a Plug-In .........................................................................21
  2.1  Static and Dynamic Linking ................................................................................ 21
  2.2  Virtual Address Space and DLL Access .............................................................. 22
  2.3  C and C++ Style DLLs ........................................................................................ 24
  2.4  Maintaining the User Interface ............................................................................ 25
  2.5  The Applications Programming Interface  ........................................................... 27
  2.6  Typical Required API Functions .......................................................................... 29
  2.7  The RackAFX Philosophy and API ..................................................................... 31
2.7.1  __stdcall .........................................................................................................31
Bibliography ............................................................................................................... 34
vii
viii  Contents
   Chapter 3: Writing Plug-Ins with RackAFX ..........................................................35
3.1  Building the DLL ................................................................................................. 35
3.2  Creation ............................................................................................................... 36
3.3  The GUI ............................................................................................................... 36
3.4  Processing Audio ................................................................................................. 37
3.5  Destruction ........................................................................................................... 38
3.6  Your First Plug-Ins ............................................................................................... 38
3.6.1  Project: Yourplugin .........................................................................................39
3.6.2  Yourplugin GUI ..............................................................................................39
3.6.3  Yourplugin.h File ............................................................................................39
3.6.4  Yourplugin.cpp File ........................................................................................40
3.6.5  Building and Testing ......................................................................................40
3.6.6  Creating and Saving Presets ...........................................................................40
3.6.7  GUI Designer .................................................................................................40
3.7  Design a Volume Control Plug-In ........................................................................ 40
3.8  Set Up RackAFX for Use .................................................................................... 41
3.9  Setup Preferences................................................................................................. 43
3.9.1  Project: Volume ..............................................................................................44
3.9.2  Volume GUI ....................................................................................................45
3.9.3  Conﬁ gure a Slider Control .............................................................................46
3.9.4  Volume.h File..................................................................................................48
3.9.5  Volume.cpp File ..............................................................................................50
3.10  Design a Volume-in-dB Plug-In........................................................................... 54
3.10.1  Project: VolumedB ........................................................................................56
3.10.2  VolumedB GUI .............................................................................................56
3.10.3  VolumedB.h File ...........................................................................................56
3.10.4  VolumedB.cpp File .......................................................................................57
3.11  Design a High-Frequency Tone Control Plug-In ................................................. 58
3.11.1  Project: SimpleHPF ......................................................................................60
3.11.2  SimpleHPF GUI ...........................................................................................60
3.11.3  SimpleHPF.h File .........................................................................................60
3.11.4  SimpleHPF.cpp File ......................................................................................62
3.12  Design a High-Frequency Tone Control with Volume Plug-In ............................ 66
3.12.1  Project: SimpleHPF ......................................................................................66
3.12.2  SimpleHPF GUI ...........................................................................................66
3.12.3  SimpleHPF.h File .........................................................................................66
3.12.4  SimpleHPF.cpp File ......................................................................................67
3.13  The User Plug-In Menu in RackAFX .................................................................. 69
     Chapter 4: How DSP Filters Work ......................................................................71
  4.1  First-Order Feed-Forward Filter .......................................................................... 74
  4.2  Design a General First-Order Feed-Forward Filter ............................................. 84
  4.3  First-Order Feed-Back Filter ............................................................................... 88
  4.4  Design a General First-Order Feed-Back Filter................................................... 89
Contents
ix
4.4.1  Project FeedBackFilter ...................................................................................89
4.4.2  FeedBackFilter GUI .......................................................................................89
4.4.3  FeedBackFilter.h File .....................................................................................89
4.4.4  FeedBackFilter.cpp File .................................................................................90
  4.5  Observations ........................................................................................................ 94
4.5.1  General ...........................................................................................................94
4.5.2  Feed-Forward Filters ......................................................................................95
4.5.3  Feed-Back Filters ...........................................................................................95
Bibliography ............................................................................................................... 95
   Chapter 5: Basic DSP Theory .............................................................................97
  5.1  The Complex Sinusoid......................................................................................... 97
  5.2  Complex Math Review ...................................................................................... 100
  5.3  Time Delay as a Math Operator ......................................................................... 102
  5.4  First-Order Feed-Forward Filter Revisited ........................................................ 103
5.4.1  Negative Frequencies ...................................................................................104
5.4.2  Frequencies Above and Below 6Nyquist ....................................................106
  5.5  Evaluating the Transfer Function H(v) ............................................................. 106
5.5.1  DC (0 Hz) .....................................................................................................107
5.5.2  Nyquist (p) ...................................................................................................108
5.5.3  ½ Nyquist (p/2) ............................................................................................109
5.5.4  ¼ Nyquist (p/4) ............................................................................................109
  5.6  Evaluating e jv ..................................................................................................... 112
  5.7  The   z   Substitution .............................................................................................. 114
  5.8  The   z   Transform ................................................................................................. 114
  5.9  The   z   Transform of Signals ................................................................................ 116
  5.10  The   z   Transform of Difference Equations .......................................................... 117
  5.11  The   z   Transform of an Impulse Response .......................................................... 118
  5.12  The   Zeros   of the Transfer Function ................................................................... 119
  5.13  Estimating the Frequency Response:   Zeros ....................................................... 121
  5.14  Filter Gain Control ............................................................................................. 122
  5.15  First-Order Feed-Back Filter Revisited ............................................................. 123
  5.16  The   Poles   of the Transfer Function .................................................................... 124
5.16.1  DC (0 Hz) ...................................................................................................128
5.16.2  Nyquist (p) .................................................................................................128
5.16.3  ½ Nyquist (p/2) ..........................................................................................129
5.16.4  ¼ Nyquist (p/4) ..........................................................................................130
  5.17  Second-Order Feed-Forward Filter .................................................................... 132
5.17.1  DC (0 Hz) ...................................................................................................139
5.17.2  Nyquist (p) .................................................................................................139
5.17.3  ½ Nyquist (p/2) ..........................................................................................140
5.17.4  ¼ Nyquist (p/4) ..........................................................................................140
  5.18  Second-Order Feed-Back Filter ......................................................................... 142
5.18.1  DC (0 Hz) ...................................................................................................148
5.18.2  Challenge ....................................................................................................149
x  Contents
  5.19  First-Order Pole-Zero Filter: The Shelving Filter ............................................. 149
5.19.1  DC (0 Hz) ...................................................................................................155
5.19.2  Challenge ....................................................................................................155
  5.20  The Bi-Quadratic Filter ...................................................................................... 157
Bibliography ............................................................................................................... 162
   Chapter 6: Audio Filter Designs: IIR Filters ........................................................163
  6.1  Direct z-Plane Design ........................................................................................ 163
  6.2  Single Pole Filters .............................................................................................. 164
6.2.1  First-Order LPF and HPF .............................................................................164
  6.3  Resonators ......................................................................................................... 165
6.3.1  Simple Resonator .........................................................................................165
6.3.2  Smith-Angell Improved Resonator ..............................................................168
  6.4  Analog Filter to Digital Filter Conversion ......................................................... 170
6.4.1  Challenge ......................................................................................................178
  6.5  Effect of Poles or Zeros at Inﬁ nity .................................................................... 178
 6.6  Generic Bi-Quad Designs .................................................................................. 181
  6.6.1  First-Order LPF and HPF .............................................................................182
6.6.2  Second-Order LPF and HPF ........................................................................183
6.6.3  Second-Order BPF and BSF ........................................................................184
6.6.4  Second-Order Butterworth LPF and HPF ....................................................184
6.6.5  Second-Order Butterworth BPF and BSF ....................................................185
  6.6.6  Second-Order Linkwitz-Riley LPF and HPF ...............................................186
6.6.7  First- and Second-Order APF .......................................................................188
  6.7  Audio Speciﬁ c Filters ........................................................................................ 188
6.7.1  Modiﬁ ed Bi-Quad ........................................................................................189
6.7.2  First-Order Shelving Filters .........................................................................189
6.7.3  Second-Order Parametric/Peaking Filter: Non-Constant-Q .........................191
6.7.4  Second-Order Parametric/Peaking Filter: Constant-Q .................................192
6.7.5  Cascaded Graphic EQ: Non-Constant-Q ......................................................194
6.7.6  Cascaded Graphic EQ: Constant-Q ..............................................................195
    6.8  Design a Resonant LPF Plug-In ........................................................................ 196
6.8.1  Project: ResonantLPF ...................................................................................197
6.8.2  ResonantLPF GUI ........................................................................................197
6.8.3  ResonantLPF.h File ......................................................................................198
6.8.4  ResonantLPF.cpp File ..................................................................................199
  6.9  The Massberg Analog-Matched Low-Pass Filter .............................................. 201
6.9.1  First-Order Massberg LPF............................................................................201
6.9.2  Second-Order Massberg LPF .......................................................................203
Bibliography ............................................................................................................. 204
References................................................................................................................. 205
   Chapter 7: Delay Effects and Circular Buffers .....................................................207
  7.1  The Basic Digital Delay ..................................................................................... 209
  7.2  Digital Delay with Wet/Dry Mix ....................................................................... 214
Contents  xi
7.2.1  Frequency and Impulse Responses...............................................................214
7.2.2  The Effect of Feedback ................................................................................218
  7.3  Design a DDL Module Plug-In.......................................................................... 224
7.3.1  Project: DDLModule ....................................................................................225
7.3.2  DDLModule GUI .........................................................................................225
7.3.3  DDLModule.h File .......................................................................................226
7.3.4  DDLModule.cpp File ...................................................................................226
7.3.5  Declare and Initialize the Delay Line Components .....................................228
7.3.6  DDLModule.h File .......................................................................................230
7.3.7  DDLModule.cpp File ...................................................................................230
  7.4  Modifying the Module to Be Used by a Parent Plug-In .................................... 233
7.4.1  DDLModule.h File .......................................................................................233
7.4.2  DDLModule.cpp File ...................................................................................234
  7.5  Modifying the Module to Implement Fractional Delay ..................................... 235
7.5.1  DDLModule.cpp File ...................................................................................238
  7.6  Design a Stereo Digital Delay Plug-In .............................................................. 239
7.6.1  Project: StereoDelay .....................................................................................239
7.6.2  StereoDelay GUI ..........................................................................................241
7.6.3  StereoDelay.h File ........................................................................................241
7.6.4  StereoDelay.cpp File ....................................................................................242
  7.7  Design a Stereo Crossed-Feedback Delay Plug-In ............................................ 244
  7.8  Enumerated Slider Variables .............................................................................. 245
7.8.1  Constructor ...................................................................................................246
7.8.2  PrepareForPlay() ..........................................................................................246
7.8.3  UserInterfaceChange() .................................................................................246
7.8.4  ProcessAudioFrame() ...................................................................................247
  7.9  More Delay Algorithms ..................................................................................... 248
7.9.1  Advanced DDL Module ...............................................................................248
  7.9.2  Delay with LPF in Feedback Loop ..............................................................248
  7.9.3  Multi-Tap Delay ...........................................................................................249
  7.9.4  Ping-Pong Delay ..........................................................................................250
  7.9.5  LCR Delay ....................................................................................................250
Bibliography ............................................................................................................. 251
   Chapter 8: Audio Filter Designs: FIR Filters .......................................................253
  8.1  The IR Revisited: Convolution .......................................................................... 253
  8.2  Using RackAFX’s Impulse Convolver .............................................................. 258
8.2.1  Loading IR Files ...........................................................................................258
8.2.2  Creating IR Files ..........................................................................................259
8.2.3  The IR File Format .......................................................................................261
  8.3  Using RackAFX’s FIR Designer ....................................................................... 262
  8.4  The Frequency Sampling Method...................................................................... 263
8.4.1  Linear-Phase FIR Using the Frequency Sampling Method ..........................263
  8.5  Complementary Filter Design for Linear Phase FIR Filters .............................. 266
  8.6  Using RackAFX’s Frequency Sampling Method Tool ...................................... 267
xii  Contents
  8.7  Designing a Complementary Filter .................................................................... 269
  8.8  The Optimal (Parks-McClellan) Method ........................................................... 270
  8.9  Using RackAFX’s Optimal Method Tool .......................................................... 271
  8.10  Design a Convolution Plug-In ........................................................................... 273
8.10.1  Project: Convolver ......................................................................................275
8.10.2  Convolver.h File .........................................................................................275
8.10.3  Convolver.cpp File......................................................................................276
  8.11  Numerical Method FIR Filters .......................................................................... 281
  8.11.1  Moving Average Interpolator .....................................................................282
  8.11.2  Lagrange Interpolator .................................................................................284
  8.11.3  Median Filter ..............................................................................................284
Bibliography ............................................................................................................... 287
   Chapter 9: Oscillators ......................................................................................289
  9.1  Direct Form Oscillator ....................................................................................... 289
9.1.1  Initial Conditions ..........................................................................................290
  9.2  Design a Direct Form Oscillator Plug-In ........................................................... 292
9.2.1  Project: DirectOscillator ...............................................................................292
9.2.2  DirectOscillator GUI ....................................................................................292
9.2.3  DirectOscillator.h File ..................................................................................294
9.2.4  DirectOscillator.cpp File ..............................................................................295
9.2.5  Improving the Oscillator Design ..................................................................297
  9.3  The Gordon-Smith Oscillator ............................................................................ 299
  9.4  Wave Table Oscillators ...................................................................................... 301
  9.5  Design a Wave Table Oscillator Plug-In ............................................................ 303
9.5.1  Project: WTOscillator ...................................................................................303
9.5.2  WTOscillator GUI ........................................................................................303
9.5.3  WTOscillator.h File ......................................................................................304
9.5.4  WTOscillator.cpp File ..................................................................................305
  9.6  Adding More Wave Tables ................................................................................. 308
9.6.1  WTOscillator.h File ......................................................................................308
9.6.2  WTOscillator.cpp File ..................................................................................309
9.6.3  WTOscillator GUI ........................................................................................310
9.6.4  WTOscillator.h File ......................................................................................310
9.6.5  WTOscillator.cpp File ..................................................................................311
  9.7  Band-Limited Additive Wave Tables ................................................................. 312
9.7.1  WTOscillator GUI ........................................................................................313
9.7.2  WTOscillator.h File ......................................................................................313
9.7.3  WTOscillator.cpp File ..................................................................................314
9.7.4  Saw-Tooth.....................................................................................................317
9.7.5  Square Wave .................................................................................................317
  9.8  Additional Oscillator Features (LFO) ................................................................ 320
9.8.1  WTOscillator.h File ......................................................................................320
9.8.2  WTOscillator.cpp File ..................................................................................321
9.8.3  WTOscillator.h File ......................................................................................321
9.8.4  WTOscillator.cpp File ..................................................................................322
Contents  xiii
9.9  Bipolar/Unipolar Functionality .......................................................................... 324
9.9.1  WTOscillator GUI ........................................................................................324
9.9.2  WTOscillator.cpp File ..................................................................................325
Bibliography ............................................................................................................. 326
  Chapter 10: Modulated Delay Effects ................................................................327
  10.1  The Flanger/Vibrato Effect .............................................................................. 328
  10.2  The Chorus Effect ............................................................................................ 331
  10.3  Design a Flanger/Vibrato/Chorus Plug-In ....................................................... 334
10.3.1  Project: ModDelayModule .........................................................................335
10.3.2  ModDelayModule GUI ..............................................................................336
10.3.3  ModDelayModule.h File ............................................................................336
10.3.4  ModDelayModule.cpp File ........................................................................337
10.3.5  PrepareForPlay() ........................................................................................340
10.3.6  Challenge ....................................................................................................342
  10.4  Design a Stereo Quadrature Flanger Plug-In ................................................... 342
10.4.1  Project: StereoQuadFlanger .......................................................................342
10.4.2  StereoQuadFlanger GUI .............................................................................342
10.4.3  StereoQuadFlanger.h File ...........................................................................342
10.4.4  StereoQuadFlanger.cpp File .......................................................................343
10.4.5  Challenges ..................................................................................................345
  10.5  Design a Multi-Unit LCR Chorus Plug-In ...................................................... 345
10.5.1  Project: StereoLCRChorus .........................................................................346
10.5.2  StereoLCRChorus GUI ..............................................................................346
10.5.3  StereoLCRChorus.h File ............................................................................346
10.5.4  StereoLCRChorus.cpp File ........................................................................347
 10.6  More Modulated Delay Algorithms ................................................................. 350
10.6.1  Stereo Cross-Flanger/Chorus (Korg Triton®) .............................................350
10.6.2  Multi-Flanger (Sony DPS-M7®) ................................................................350
10.6.3  Bass Chorus ................................................................................................350
10.6.4  Dimension-Style (Roland Dimension D®) .................................................351
10.6.5  Deca-Chorus (Sony DPS-M7®) ..................................................................354
Bibliography ............................................................................................................. 355
   Chapter 11: Reverb Algorithms .........................................................................357
  11.1  Anatomy of a Room Impulse Response .......................................................... 358
11.1.1  RT60: The Reverb Time ...............................................................................359
  11.2  Echoes and Modes ........................................................................................... 360
  11.3  The Comb Filter Reverberator ......................................................................... 364
  11.4  The Delaying All-Pass Filter Reverberator ...................................................... 368
  11.5  More Delaying All-Pass Filter Reverberators .................................................. 370
  11.6  Schroeder’s Reverberator ................................................................................. 372
  11.7  The Low-Pass Filter–Comb Reverberator ....................................................... 373
  11.8  Moorer’s Reverberator ..................................................................................... 375
  11.9  Stereo Reverberation ........................................................................................ 376
  11.10  Gardner’s Nested APF Reverberators .............................................................. 377
xiv  Contents
  11.11  Modulated APF and Comb/APF Reverb ......................................................... 381
  11.12  Dattorro’s Plate Reverb .................................................................................... 382
  11.13  Generalized Feedback Delay Network Reverbs .............................................. 385
  11.14  Other FDN Reverbs ......................................................................................... 389
  11.15  An Example Room Reverb .............................................................................. 391
  11.16  RackAFX Stock Objects .................................................................................. 394
11.16.1  COnePoleLPF ...........................................................................................394
11.16.2  CDelay ......................................................................................................395
11.16.3  CCombFilter .............................................................................................396
11.16.4  CLPFCombFilter ......................................................................................396
11.16.5  CDelayAPF ..............................................................................................398
  11.17  Design the Room Reverb ................................................................................. 398
11.17.1  Project: Reverb .........................................................................................398
11.17.2  Reverb GUI ..............................................................................................398
11.17.3  Reverb.h ....................................................................................................402
11.17.4  Reverb.cpp ................................................................................................403
11.18  Challenge ......................................................................................................... 408
Bibliography ............................................................................................................... 409
References .................................................................................................................. 409
   Chapter 12: Modulated Filter Effects.................................................................411
  12.1  Design a Mod Filter Plug-In: Part I Modulated fc  ........................................... 412
12.1.1  Project: ModFilter ......................................................................................413
12.1.2  ModFilter GUI ............................................................................................413
12.1.3  ModFilter.h File ..........................................................................................413
12.1.4  ModFilter.cpp File ......................................................................................416
  12.2  Design a Mod Filter Plug-In: Part II, Modulated fc, Q .................................... 419
12.2.1  ModFilter GUI ............................................................................................419
12.2.2  ModFilter.h File ..........................................................................................419
12.2.3  ModFilter.cpp File ......................................................................................420
  12.3  Design a Mod Filter Plug-In: Part III, Quad-Phase LFOs ............................... 423
12.3.1  ModFilter GUI ............................................................................................423
12.3.2  ModFilter.cpp File ......................................................................................424
  12.4  Design an Envelope Follower Plug-In ............................................................. 425
  12.5  Envelope Detection .......................................................................................... 428
12.5.1  Project EnvelopeFollower ..........................................................................430
12.5.2  EnvelopeFollower GUI ...............................................................................430
12.5.3  EnvelopeFollower.h File .............................................................................431
12.5.4  EnvelopeFollower.cpp File .........................................................................432
  12.6  Design a Phaser Plug-In................................................................................... 436
12.6.1  Project Phaser .............................................................................................440
12.6.2  Phaser GUI .................................................................................................440
12.6.3  Phaser.h File ...............................................................................................440
12.6.4  Phaser.cpp File ...........................................................................................441
Contents  xv
  12.7  Design a Stereo Phaser with Quad-Phase LFOs .............................................. 446
12.7.1  Phaser GUI .................................................................................................446
12.7.2  Phaser.h File ...............................................................................................446
12.7.3  Phaser.cpp File ...........................................................................................447
Bibliography ............................................................................................................. 451
References................................................................................................................. 451
   Chapter 13: Dynamics Processing ......................................................................453
  13.1  Design a Compressor/Limiter Plug-In ............................................................. 457
13.1.1  Project: DynamicsProcessor .......................................................................458
13.1.2  DynamicsProcessor: GUI ...........................................................................458
13.1.3  DynamicsProcessor.h File ..........................................................................459
13.1.4  DynamicsProcessor.cpp File ......................................................................460
13.1.5  DynamicsProcessor.cpp File ......................................................................465
  13.2  Design a Downward Expander/Gate Plug-In ................................................... 466
13.2.1  DynamicsProcessor.h File ..........................................................................466
13.2.2  DynamicsProcessor.cpp File ......................................................................466
  13.3  Design a Look-Ahead Compressor Plug-In ..................................................... 468
13.3.1  DynamicsProcessor: GUI ...........................................................................469
13.3.2  DynamicsProcessor.h File ..........................................................................470
13.3.3  DynamicsProcessor.cpp File ......................................................................470
  13.4  Stereo-Linking the Dynamics Processor ......................................................... 472
13.4.1 DynamicsProcessor: GUI ............................................................................472
13.4.2  DynamicsProcessor.cpp File ......................................................................473
  13.5  Design a Spectral Compressor/Expander Plug-In ........................................... 475
13.5.1  Project: SpectralDynamics .........................................................................476
13.5.2  SpectralDynamics: GUI .............................................................................476
13.5.3  Additional Slider Controls ..........................................................................477
13.5.4  Spectral Dynamics Buttons ........................................................................477
13.5.5  Spectral Dynamics Metering ......................................................................477
13.5.6  SpectralDynamics.h File ............................................................................478
13.5.7  SpectralDynamics.cpp File .........................................................................479
  13.6  Alternate Side-Chain Conﬁ gurations ............................................................... 486
Bibliography ............................................................................................................. 487
References................................................................................................................. 487
   Chapter 14: Miscellaneous Plug-Ins ...................................................................489
  14.1  Design a Tremolo/Panning Plug-In ................................................................. 489
14.1.1  Project: TremoloPanner ..............................................................................490
14.1.2  TremoloPanner: GUI ..................................................................................490
  14.2  Design a Ring Modulator Plug-In ................................................................... 494
14.2.1  Project: RingModulator ..............................................................................494
14.2.2  RingModulator: GUI ..................................................................................494
14.2.3  RingModulator.h File .................................................................................495
14.2.4  RingModulator.cpp File .............................................................................495
xvi  Contents
  14.3  Design a Wave Shaper Plug-In ........................................................................ 497
14.3.1  Project: WaveShaper ...................................................................................498
14.3.2  WaveShaper: GUI .......................................................................................498
Bibliography ............................................................................................................. 500
   Appendix A: The VST® and AU® Plug-In APIs .....................................................501
  A.1  Compiling as a VST Plug-In in Windows ......................................................... 501
  A.2  Wrapping Your RackAFX Plug-In .................................................................... 503
  A.3  Comparison of Objects/Methods/GUIs ............................................................ 505
  A.4  VST Plug-In without Wrapping ........................................................................ 506
A.4.1  Default GUI .................................................................................................507
A.4.2  Signal Processing ........................................................................................509
  A.5  VST Plug-In with RackAFX Wrapping ............................................................ 512
A.5.1  Default GUI .................................................................................................512
  A.6  AU Overview .................................................................................................... 514
A.6.1  Default GUI .................................................................................................515
A.6.2  Signal Processing ........................................................................................516
   Appendix B: More RackAFX Controls and GUI Designer ......................................519
  B.1  The Alpha Wheel and LCD Control .................................................................. 519
  B.2  The Vector Joystick Control .............................................................................. 521
  B.3  Using the sendUpdateGUI() Method ................................................................ 525
  B.4  Using GUI Designer.......................................................................................... 525
Index ..............................................................................................................531
 Introduction
 When I started teaching in the Music Engineering Technology Program at the University of
Miami in 1996, we were writing signal processing algorithms in digital signal processing
(DSP) assembly language and loading them on to DSP evaluation boards for testing. We had
also just begun teaching a software plug-in programming class, since computers were ﬁ nally
at the point where native processing was feasible. I began teaching Microsoft’s DirectX ®  in
1997 and immediately began a book/manual on converting DSP algorithms into C++ code for
the DirectX platform. A year later I had my ﬁ rst manuscript of what would be a thick DirectX
programming book. However, I had two problems on my hands: ﬁ rst, DirectX is bloated
with Common Object Model (COM) programming, and it seemed like the lion’s share of the
book was really devoted to teaching basic COM skills rather than converting audio signal
processing algorithms into C++, creating a graphical user interface (GUI), and handling
user input. More importantly, developers had dropped DirectX in favor of a new, lean, cross-
platform compatible plug-in format called Steinberg VST ® , written in “straight” C++ without
the need for operating system (OS) speciﬁ c components. After taking one look at the Virtual
Studio Technology  (VST) applications programming interface (API), I immediately dropped
all DirectX development, wrote VST plug-ins all summer, and then switched to teaching it the
following year. And, I put my now-obsolete manuscript on the shelf.
 After half a dozen semesters teaching VST programming, a few things had become clear.
For any given project, the students were spending more time dealing with setting up and
maintaining a GUI than they were with the audio signal processing code. Instead of being on
the Internet to look for cool processing algorithms, they were searching for knob and switch
bitmaps. While I can certainly appreciate a nice-looking GUI, I was trying to teach audio
signal processing and not graphic design. I next spent some time trying to come up with some
kind of way to speed up the GUI programming, and I wrote a helper program that let students
deﬁ ne lists of variable names, data types, minimum, maximum, and initial values. Then it
would synthesize the code for handling part of the GUI interaction. The actual GUI itself was
another problem, and I spent years trying to come up with a way to free the students (and
myself) from dealing with the hassles of designing and maintaining a GUI. Around 2004,
as a result of a consulting job, I needed to come up with a simple C++ based audio signal
processing API—my own plug-in format. I would also need to write my own plug-in client,
xvii
xviii
 Introduction
the software that would load and process data through my plug-ins. I was determined to write
an API that was far simpler and leaner than even VST. And, I wanted my client software
to handle 100% of the GUI details so I could focus on the signal processing work for my
consulting client. This would also make great software to teach audio signal processing and
plug-in programming simultaneously.
 Since 2009 I’ve been using my RackAFX™ software in the classroom at both the graduate
and undergraduate levels. My students never cease to amaze me with what they design.
Currently, RackAFX runs on the Windows ®  OS and generates plug-ins that are compatible
with it and optionally VST as well. You can develop your plug-in in RackAFX, then use it in
any Windows VST client. RackAFX runs in tandem with Microsoft Visual Studio compilers,
even the free ones. It sets up your project ﬁ les, writes GUI code for you, and allows you to
remotely launch some compiler functions from its control surface. Once you understand
how the RackAFX API works, learning other commercial plug-in APIs will be much easier
because most plug-in APIs share similar methods and set-up sequences. And, since RackAFX
plug-ins are written in C++, the plug-in objects can be compiled on different platforms and
embedded (or wrapped) to operate in just about any signal processing environment. We are
currently running RackAFX plug-ins in Apple’s iOS ®  in one of my other classes.
 In the fall of 2010 I began writing and handing out chapters, one at a time, to students in a
graduate-level class. The chapters combined DSP theory, audio algorithms, and programming
in the proportions I had always wanted, including difference equations and derivations that
were fully worked out. The RackAFX API requires zero GUI programming. It isn’t tied to a
licensed product that I have to worry will become obsolete or will change in complexity or
underlying design. Most importantly, if you can learn to write RackAFX plug-ins, you can
learn to write for just about any other API on the platform you choose. See Appendix A for
more information.
 Those initial grad students helped shape the direction and ﬂ ow of the book (perhaps without
knowing it). I wanted the book to be aimed at people with programming skills who wanted
to get into audio signal processing or the other way around. Academic types that are tired of
using mathematical software to try to do real-time signal processing should also beneﬁ t. The
API does not require a steep learning curve.
 Chapter 1 presents the number systems, sample indexing, and basic block diagram algorithm
components. Chapter 2 explains how plug-ins are packaged in software and Chapter 3
immediately starts you writing plug-ins. Chapters 4 and 5 are the basic DSP theory chapters.
Feel free to skip these chapters if you already have a strong DSP background or if you don’t
care about it. Chapter 6 is a cookbook of inﬁ nite impulse response (IIR) and audio speciﬁ c
ﬁ lter designs. Chapter 7 introduces delay lines and delay effects. The circular buffering they
require is necessary for Chapter 8’s ﬁ nite impulse response (FIR) tools and convolution
plug-in.
 Introduction
 xix
 Chapter 9 introduces oscillator design, which is needed in Chapter 10’s modulated delay
effects: ﬂ anger, chorus and vibrato effects. Chapter 11 includes the analysis of a collection
of reverberator modules and an example reverb design. Chapter 12 returns to the modulation
theme with modulated ﬁ lter effects, including my own phaser, while Chapter 13 introduces
dynamics processor design. Chapter 14 is a clean-up chapter of miscellaneous effects
algorithms. The two appendices can be read any time after Chapter 3, where you design
your ﬁ rst plug-ins. Appendix A deals with the VST and Audio Units (AU)  ®  formats, their
similarities and differences, and how to use RackAFX objects inside them. Appendix B shows
how to use the GUI designer to drag and drop GUI elements on your control surface—0%
GUI coding, guaranteed. And, if you have the tools and skills to make and maintain your own
GUI, there are options for that as well.
 My colleagues Ken Pohlmann, Joe Abbati, Colby Leider, Chris Bennett, and Rey Sanchez
had nothing but encouragement and enthusiasm for the book/software effort. Like many of
the students, they watched RackAFX evolve—even change names—from a fairly bland, gray
academic interface into a highly customizable personal plug-in development lab with a drag-
and-drop GUI designer. Of course those features and enhancements came from suggestions,
comments, and critiques from the numerous students who used the software in class. The API
would not be as robust today without their invaluable input and feedback. Stefan Sullivan
tirelessly beta-tested the software, even in the middle of his thesis work; his comments led
to many of the features in the current product. The RackAFX power users (students who
went above and beyond the parameters of their projects and pushed the envelope of the API)
include Mike Chemistruck, Greg Dion, Felipe Espic, Chen Zhang, Tim Schweichler, Phil
Minnick, Sherif Ahmed, Scott Dickey, Matan Ben-Asher, Jay Coggin, Michael Everman, and
Jordan Whitney.
 I hope you enjoy learning the audio effects theory and plug-in design from the book and
that each chapter opens up a new treasure box of cool audio gems you can use to make your
own truly unique audio effects in your own audio effect laboratory. The software FAQs,
sample code, and tutorials are all available at the website  www.willpirkle.com  and you are
encouraged to upload your own plug-ins and videos as well. I can’t wait to hear what you
cook up in your lab!
 Will Pirkle
 June 1, 2012

CHAP TE R 1
